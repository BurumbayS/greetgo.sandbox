<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
<!-- TODO: База составлена неверно. Свериться с описанной базой в методологии и исправить. -->
  <changeSet author="pompei" id="create-function-moment">
    <sql endDelimiter=";;"><![CDATA[
      create function moment() returns timestamp
      language plpgsql as 'begin return current_timestamp; end '
    ]]></sql>
  </changeSet>

  <changeSet author="pompei" id="create-table-charms">
    <sql endDelimiter=";;"><![CDATA[
      create table charms (
        id int not null primary key,
        name varchar(255) not null,
        description varchar(255),
        energy float
      )
    ]]></sql>
  </changeSet>

  <changeSet author="pompei" id="create-table-clients">
    <sql endDelimiter=";;"><![CDATA[
      create table clients (
        id int not null primary key,
        surname varchar(255) not null,
        name varchar(255) not null,
        patronymic varchar(255),
        gender varchar(10),
        birth_date date,
        charm_id int REFERENCES charms(id)
      )
    ]]></sql>
  </changeSet>

  <changeSet author="pompei" id="create-table-adresses">
    <sql endDelimiter=";;"><![CDATA[
      create table adresses (
        id int not null primary key,
        adressType varchar(10) not null,
        street varchar(255) not null,
        house varchar(255) not null,
        flat varchar(255) not null,
        client_id int references clients(id)
      )
    ]]></sql>
  </changeSet>

  <changeSet author="pompei" id="create-table-phones">
    <sql endDelimiter=";;"><![CDATA[
      create table phones (
        number varchar(20) not null primary key,
        phoneType varchar(10) not null,
        client_id int references clients(id)
      )
    ]]></sql>
  </changeSet>

  <changeSet author="pompei" id="create-table-accounts">
    <sql endDelimiter=";;"><![CDATA[
      create table accounts (
        id int not null primary key,
        money float default 0,
        number varchar(100),
        registered_at timestamp,
        client_id int references clients(id)
      )
    ]]></sql>
  </changeSet>

  <changeSet author="pompei" id="create-table-transaction_types">
    <sql endDelimiter=";;"><![CDATA[
      create table transaction_types (
        id int not null primary key,
        code varchar(200),
        name varchar(200)
      )
    ]]></sql>
  </changeSet>

  <changeSet author="pompei" id="create-table-transactions">
    <sql endDelimiter=";;"><![CDATA[
      create table transactions (
        id int not null primary key,
        money float,
        finished_at timestamp,
        account_id int references accounts(id),
        transaction_type_id int references transaction_types(id)
      )
    ]]></sql>
  </changeSet>

</databaseChangeLog>
